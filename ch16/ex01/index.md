### 用語「マルチスレッド」について調べなさい。

マルチスレッドとは、1つのプロセス内で複数のスレッドを同時に実行することである。各スレッドは独立して動作し、同じメモリ空間を共有する。
これにより、複数のタスクを並行して処理することができ、パフォーマンスは向上する。
一方で、スレッド間の競合状態やデータの整合性を管理するなど、注意が必要な点がある。

### 次にフィボナッチ数を計算するmFib.jsをスレッド数を変更しながら実行し、コンソール出力とOS機能で結果とスレッド数を確認しなさい。

スレッド数を変更しながら実行するために、スレッド数を`x`として、以下のコマンドを実行した。(出題内容に合わせて項数を45に変更して実行した)

```
node mFib.js 45 x
```

結果:

- x = 1, 実行時間: 11.069s, スレッド数: 12
- x = 2, 実行時間: 6.980s, スレッド数: 13
- x = 3, 実行時間: 5.463s, スレッド数: 14
- x = 4, 実行時間: 4.872s, スレッド数: 12
- x = 5, 実行時間: 4.557s, スレッド数: 12
- x = 6, 実行時間: 4.417s, スレッド数: 17
- x = 7, 実行時間: 4.402s, スレッド数: 18
- x = 8, 実行時間: 4.298s, スレッド数: 15
- x = 9, 実行時間: 4.276s, スレッド数: 19
- x = 10, 実行時間: 4.243s, スレッド数: 13
- x = 11, 実行時間: 4.235s, スレッド数: 12
- x = 12, 実行時間: 4.299s, スレッド数: 14
- x = 13, 実行時間: 4.255s, スレッド数: 13
- x = 14, 実行時間: 4.212s, スレッド数: 14
- x = 15, 実行時間: 4.322s, スレッド数: 16
- x = 16, 実行時間: 4.485s, スレッド数: 12
- x = 17, 実行時間: 4.279s, スレッド数: 15

### 実行環境のCPUスペックを調査し、適切なスレッド数についての考察を記しなさい。

以下のコマンドを実行し、CPUスペックを調査した。

```
sysctl -a | grep machdep.cpu
machdep.cpu.cores_per_package: 12
machdep.cpu.core_count: 12
machdep.cpu.logical_per_package: 12
machdep.cpu.thread_count: 12
machdep.cpu.brand_string: Apple M3 Pro
```

つまり、
CPUモデル: Apple M3 Pro
物理コア数 (core_count): 12
論理コア数 (thread_count): 12
である。

上記の結果を見ると、スレッド数`x = 1`から`x = 6`までは実行時間が大幅に短縮されているが、それ以降はほとんど変化が見られなかった。
実行環境のApple M3 Proは計算処理が高性能なPコアが6コア、処理能力の低いEコアが6コアで構成されており(\*)、`x = 6`までのスレッド数増加はPコアに対応していると考えられる。その後はEコアが主に使用されるため、パフォーマンスの向上が限定的になったと推測される。

また、コア数が12である環境下で、`x=14`の際に最速値となった。
これはコア数よりも少し多めにスレッドを投入することで、OSのバックグラウンド処理などで個別のスレッドが一瞬停止した際にも、即座に他のスレッドがCPUリソースを使用することができ、結果的に効率よく処理が進むためと考えられる。

\*: https://gigazine.net/news/20231127-apple-m3-core/
